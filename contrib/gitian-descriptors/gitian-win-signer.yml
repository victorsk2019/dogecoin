---
<<<<<<< HEAD
name: "dogecoin-win-signer"
=======
name: "bitcoin-win-signer"
distro: "ubuntu"
>>>>>>> 1.21-dev
suites:
- "bionic"
architectures:
- "amd64"
packages:
- "libssl-dev"
- "autoconf"
- "automake"
- "libtool"
- "pkg-config"
remotes:
- "url": "https://github.com/dogecoin/dogecoin-detached-sigs.git"
  "dir": "signature"
files:
<<<<<<< HEAD
- "osslsigncode_1.7.1.orig.tar.gz"
- "osslsigncode-Backports-to-1.7.1.patch"
- "dogecoin-win-unsigned.tar.gz"
=======
- "osslsigncode-2.0.tar.gz"
- "bitcoin-win-unsigned.tar.gz"
>>>>>>> 1.21-dev
script: |
  set -e -o pipefail

  BUILD_DIR="$PWD"
  SIGDIR=${BUILD_DIR}/signature/win
  UNSIGNED_DIR=${BUILD_DIR}/unsigned

<<<<<<< HEAD
  echo "f9a8cdb38b9c309326764ebc937cba1523a3a751a7ab05df3ecc99d18ae466c9  osslsigncode_1.7.1.orig.tar.gz" | sha256sum -c
  echo "a8c4e9cafba922f89de0df1f2152e7be286aba73f78505169bc351a7938dd911  osslsigncode-Backports-to-1.7.1.patch" | sha256sum -c
=======
  echo "5a60e0a4b3e0b4d655317b2f12a810211c50242138322b16e7e01c6fbb89d92f  osslsigncode-2.0.tar.gz" | sha256sum -c
>>>>>>> 1.21-dev

  mkdir -p ${UNSIGNED_DIR}
  tar -C ${UNSIGNED_DIR} -xf dogecoin-win-unsigned.tar.gz

<<<<<<< HEAD
  tar xf osslsigncode_1.7.1.orig.tar.gz
  cd osslsigncode-1.7.1
  patch -p1 < ${BUILD_DIR}/osslsigncode-Backports-to-1.7.1.patch
=======
  tar xf osslsigncode-2.0.tar.gz
  cd osslsigncode-2.0
>>>>>>> 1.21-dev

  ./autogen.sh
  ./configure --without-gsf --without-curl --disable-dependency-tracking
  make
  find ${UNSIGNED_DIR} -name "*-unsigned.exe" | while read i; do
    INFILE="$(basename "${i}")"
    OUTFILE="${INFILE/-unsigned}"
    ./osslsigncode attach-signature -in "${i}" -out "${OUTDIR}/${OUTFILE}" -sigin "${SIGDIR}/${INFILE}.pem"
  done
